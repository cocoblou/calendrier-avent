<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Puzzle CÅ“ur 6x6</title>

<style>
    body {
        background: #f7e9ef;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
    }

    h2 {
        color: #b3004b;
        margin-bottom: 20px;
    }

    #puzzle-container {
        width: 600px;
        height: 600px;
        margin: 0 auto;
        position: relative;
        background: #ffffff;
        border: 2px solid #b3004b;
        border-radius: 12px;
    }

    .piece {
        width: 100px;
        height: 100px;
        background-image: url('coeur.jpg');
        background-size: 600px 600px;
        border-radius: 6px;
        cursor: grab;
        position: absolute;
        transition: transform 0.1s;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);

        /* IMPORTANT POUR MOBILE */
        touch-action: none;
    }
</style>
</head>
<body>

<h2>Puzzle</h2>

<div id="puzzle-container"></div>

<script>
const container = document.getElementById("puzzle-container");

const grid = 6;
const pieceSize = 600 / grid;   
const magnetRange = 20;

/* ------------------------------
   CRÃ‰ATION DES 36 PIÃˆCES
------------------------------ */
for (let i = 0; i < grid; i++) {
    for (let j = 0; j < grid; j++) {

        const piece = document.createElement("div");
        piece.classList.add("piece");

        // Position du morceau dans l'image
        piece.style.backgroundPosition =
            `-${j * pieceSize}px -${i * pieceSize}px`;

        // Position de dÃ©part alÃ©atoire
        piece.style.left = (Math.random() * 500 - 50) + "px";
        piece.style.top = (Math.random() * 500 - 50) + "px";

        // Position correcte
        piece.dataset.correctX = j * pieceSize;
        piece.dataset.correctY = i * pieceSize;

        makeDraggable(piece);
        container.appendChild(piece);
    }
}

/* ------------------------------
   GESTION SOURIS + TACTILE
------------------------------ */

function getPos(e) {
    if (e.touches && e.touches.length > 0) {
        return { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }
    return { x: e.clientX, y: e.clientY };
}

function makeDraggable(piece) {
    let offsetX = 0;
    let offsetY = 0;

    function startDrag(e) {
        e.preventDefault();

        const pos = getPos(e);
        offsetX = pos.x - piece.offsetLeft;
        offsetY = pos.y - piece.offsetTop;

        piece.style.zIndex = 1000;

        document.addEventListener("mousemove", onDrag);
        document.addEventListener("mouseup", endDrag);

        document.addEventListener("touchmove", onDrag, { passive: false });
        document.addEventListener("touchend", endDrag);
    }

    function onDrag(e) {
        e.preventDefault();
        const pos = getPos(e);

        piece.style.left = pos.x - offsetX + "px";
        piece.style.top = pos.y - offsetY + "px";

        // ðŸŽ¯ AIMANT
        const dx = piece.offsetLeft - piece.dataset.correctX;
        const dy = piece.offsetTop - piece.dataset.correctY;

        if (Math.abs(dx) < magnetRange && Math.abs(dy) < magnetRange) {
            piece.style.left = piece.dataset.correctX + "px";
            piece.style.top = piece.dataset.correctY + "px";
        }
    }

    function endDrag() {
        document.removeEventListener("mousemove", onDrag);
        document.removeEventListener("mouseup", endDrag);

        document.removeEventListener("touchmove", onDrag);
        document.removeEventListener("touchend", endDrag);

        piece.style.zIndex = 1;
    }

    // Pour PC
    piece.addEventListener("mousedown", startDrag);

    // Pour tÃ©lÃ©phone
    piece.addEventListener("touchstart", startDrag, { passive: false });
}
</script>

</body>
</html>
